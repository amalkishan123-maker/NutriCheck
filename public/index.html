<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NutriCheck Pro</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://unpkg.com/@zxing/library@latest"></script>
  <style>
    :root {
      --primary:#00ff95; --danger:#ff4757; --warning:#ffa502;
      --bg:#050505; --card-bg:#121212; --border:rgba(255,255,255,0.1);
    }
    body{background:var(--bg);color:white;font-family:Inter,sans-serif;margin:0;display:flex;flex-direction:column;align-items:center}
    #scanner-container{width:100%;max-width:450px;height:300px;background:#000;position:relative}
    video{width:100%;height:100%;object-fit:cover}
    .scan-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:250px;height:150px;border:2px solid var(--primary);border-radius:15px}
    .content{width:90%;max-width:400px;margin-top:-30px}
    .main-card{background:var(--card-bg);border-radius:24px;padding:24px;border:1px solid var(--border)}
    .score-circle{width:80px;height:80px;border-radius:50%;border:5px solid var(--primary);display:flex;align-items:center;justify-content:center;font-size:24px;font-weight:800}
    .tabs{display:flex;gap:10px;margin-bottom:15px}
    .tab-btn{flex:1;padding:10px;border:none;background:#222;color:#888;border-radius:8px}
    .tab-btn.active{background:#000;color:var(--primary)}
    .section{display:none} .section.active{display:block}
    .stat-row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .stat-box{background:#1a1a1a;padding:12px;border-radius:14px}
    .label{font-size:11px;color:#666;text-transform:uppercase}
    .val{font-size:18px;font-weight:600}
    .tag{background:rgba(255,71,87,.15);color:var(--danger);padding:4px 10px;border-radius:20px;font-size:12px;margin:3px;display:inline-block}
    .primary-btn{width:100%;padding:16px;background:var(--primary);border:none;border-radius:14px;font-weight:700;margin-top:15px}
  </style>
</head>

<body>

<div id="scanner-container">
  <video id="video"></video>
  <div class="scan-overlay"></div>
</div>

<div class="content">
  <div class="main-card">
    <input id="barcode" placeholder="Barcode..." style="width:100%;background:none;border:none;color:white;text-align:center;margin-bottom:10px">

    <div id="result-ui" style="display:none">
      <div style="display:flex;gap:15px;margin-bottom:15px">
        <div id="score-ring" class="score-circle">--</div>
        <div>
          <h2 id="prod-name"></h2>
          <p id="prod-swap" style="color:#888;font-size:12px"></p>
        </div>
      </div>

      <div class="tabs">
        <button class="tab-btn active" onclick="showTab('summary',this)">Summary</button>
        <button class="tab-btn" onclick="showTab('ingredients',this)">Ingredients</button>
      </div>

      <div id="summary" class="section active">
        <div class="stat-row">
          <div class="stat-box"><div class="label">Sugar</div><div id="val-sugar" class="val"></div></div>
          <div class="stat-box"><div class="label">Energy</div><div id="val-energy" class="val"></div></div>
        </div>
        <div class="stat-row">
          <div class="stat-box"><div class="label">Fat</div><div id="val-fat" class="val"></div></div>
          <div class="stat-box"><div class="label">Salt</div><div id="val-salt" class="val"></div></div>
        </div>
      </div>

      <div id="ingredients" class="section">
        <div class="label">Harmful Additives</div>
        <div id="harmful-list"></div>
        <div class="label">Full Ingredients</div>
        <p id="full-ingredients" style="font-size:13px;color:#aaa"></p>
      </div>
    </div>

    <button class="primary-btn" onclick="analyze()">RUN ANALYSIS</button>
  </div>
</div>

<script>
const reader = new ZXing.BrowserMultiFormatReader();
reader.decodeFromVideoDevice(null,'video',(res)=>{
  if(res) document.getElementById("barcode").value = res.text;
});

function showTab(id,btn){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  btn.classList.add('active');
}

async function analyze(){
  const code = barcode.value;
  const res = await fetch(`/api/check/${code}`);
  const data = await res.json();
  if(data.error) return alert("Not found");

  result-ui.style.display="block";

  const sugar = parseFloat(data.sugar)||0;
  let score = Math.max(0,100 - sugar*4);

  score-ring.innerText = score.toFixed(0);
  prod-name.innerText = data.productName;
  prod-swap.innerText = "Swap: "+data.alternativeBrand;
  val-sugar.innerText = sugar+"g";
  val-fat.innerText = (data.fat||0)+"g";
  val-salt.innerText = (data.salt||0)+"g";
  val-energy.innerText = (data.energy||0)+" kcal";

  harmful-list.innerHTML = data.ingredientAnalysis.harmful.map(x=>`<span class="tag">${x}</span>`).join("");
  full-ingredients.innerText = data.ingredients || "No data";
}
  <script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/service-worker.js");
}
</script>
</body>
</html>
