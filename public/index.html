<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Nutri</title>
<style>
body{margin:0;font-family:Arial;background:#f4f6f8}
.header{background:#4caf50;color:white;padding:16px;font-size:20px}
.card{background:white;margin:12px;padding:16px;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,.1)}
.score{width:100px;height:100px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:32px;margin:auto;color:white}
.good{background:#4caf50}
.mid{background:#ff9800}
.bad{background:#f44336}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.stat{background:#eee;padding:10px;border-radius:8px;text-align:center}
.tabbar{display:flex}
.tab{flex:1;padding:10px;text-align:center;border-bottom:2px solid #ccc}
.tab.active{border-color:#4caf50;font-weight:bold}
.hidden{display:none}
.tag{background:#ffcdd2;color:#c62828;padding:4px 8px;border-radius:20px;margin:4px;display:inline-block}
</style>
</head>

<body>

<div class="header">Nutri</div>

<div class="card">
<input id="barcode" placeholder="Enter barcode" style="width:100%;padding:10px">
<br><br>
<input type="file" accept="image/*" capture="environment" id="camera">
<br><br>
<button onclick="analyze()" style="width:100%;padding:12px;background:#4caf50;color:white;border:none">Analyze</button>
</div>

<div id="result" class="hidden">

<div class="card">
<h2 id="name"></h2>
<div id="scoreCircle" class="score"></div>
<p id="swap"></p>
</div>

<div class="tabbar">
<div class="tab active" onclick="openTab('nut')">Nutrition</div>
<div class="tab" onclick="openTab('ing')">Ingredients</div>
</div>

<div id="nut" class="card">
<div class="grid">
<div class="stat">Sugar<br><b id="sugar"></b></div>
<div class="stat">Fat<br><b id="fat"></b></div>
<div class="stat">Fiber<br><b id="fiber"></b></div>
<div class="stat">Energy<br><b id="energy"></b></div>
</div>
</div>

<div id="ing" class="card hidden">
<div id="harmful"></div>
<p id="full"></p>
</div>

</div>

<script>
function openTab(id){
document.querySelectorAll(".tab").forEach(t=>t.classList.remove("active"))
document.querySelectorAll(".card").forEach(c=>{})
document.getElementById("nut").classList.add("hidden")
document.getElementById("ing").classList.add("hidden")
document.getElementById(id).classList.remove("hidden")
event.target.classList.add("active")
}

async function analyze(){
const code=document.getElementById("barcode").value
if(!code) return alert("Enter barcode")

const res=await fetch("/api/check/"+code)
const d=await res.json()
if(d.error) return alert("Not found")

document.getElementById("result").classList.remove("hidden")

document.getElementById("name").innerText=d.productName
document.getElementById("swap").innerText="Better brand: "+d.alternativeBrand

document.getElementById("sugar").innerText=d.sugar+" g"
document.getElementById("fat").innerText=d.fat+" g"
document.getElementById("fiber").innerText=d.fiber+" g"
document.getElementById("energy").innerText=d.energy+" kcal"

let score=100-(d.sugar*4)
score=Math.max(0,Math.min(100,score))
const circle=document.getElementById("scoreCircle")
circle.innerText=score
circle.className="score "+(score>70?"good":score>40?"mid":"bad")

document.getElementById("harmful").innerHTML=
d.ingredientAnalysis.harmful.map(h=>"<span class='tag'>"+h+"</span>").join("")
document.getElementById("full").innerText=d.ingredients
}
</script>

</body>
</html>