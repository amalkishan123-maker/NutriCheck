<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nutri</title>

<style>
body{margin:0;font-family:Arial,sans-serif;background:#0b0b0b;color:#fff}
.container{max-width:460px;margin:auto;padding:16px}
h1{color:#4caf50;margin:4px 0}
.tagline{color:#aaa;font-size:14px;margin-bottom:12px}

.card{background:#141414;border:1px solid #1f1f1f;border-radius:12px;padding:14px;margin-bottom:14px}

input{width:100%;padding:14px;border-radius:8px;border:none;background:#1f1f1f;color:#fff;margin-bottom:8px}
button{width:100%;padding:14px;border-radius:8px;border:none;font-weight:bold;margin-bottom:8px;cursor:pointer}
.scanBtn{background:#222;color:#fff}
.checkBtn{background:#4caf50;color:#000}

.tabs{display:flex;gap:6px;margin-bottom:10px}
.tab{flex:1;text-align:center;padding:10px;border-radius:8px;background:#1f1f1f;color:#bbb;cursor:pointer}
.tab.active{background:#4caf50;color:#000;font-weight:bold}

.score{width:120px;height:120px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:34px;margin:10px auto}
.healthy{background:#1b5e20}
.moderate{background:#f9a825;color:#000}
.unhealthy{background:#8e0000}

.legend{font-size:12px;color:#bbb;text-align:center}
.legend span{margin-right:8px}

.sectionTitle{font-weight:bold;margin:6px 0}
.good{color:#66bb6a}
.bad{color:#ef5350}

.row{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid #222}
.row:last-child{border-bottom:none}
.value.good{color:#66bb6a}
.value.mid{color:#ffb74d}
.value.bad{color:#ef5350}

details{background:#111;border-radius:10px;padding:10px;margin-bottom:8px}
details summary{cursor:pointer;font-weight:bold}

.ingredients{font-size:13px;color:#bbb;line-height:1.5}
.warning{color:#ffcc80;font-size:13px;margin-top:8px}

video{width:100%;border-radius:10px;display:none;margin-bottom:8px}

footer{font-size:12px;color:#888;text-align:center;margin-top:10px}
.hidden{display:none}
</style>
</head>

<body>
<div class="container">
  <h1>Nutri</h1>
  <div class="tagline">Scan Â· Understand Â· Decide</div>

  <div class="card">
    <input id="barcode" placeholder="Enter barcode number">
    <button class="scanBtn" onclick="startScan()">ðŸ“· Scan Barcode</button>
    <button class="checkBtn" onclick="checkFood()">Check Food</button>
    <video id="video"></video>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="showTab('overview')">Overview</div>
    <div class="tab" onclick="showTab('nutrition')">Nutrition</div>
    <div class="tab" onclick="showTab('ingredients')">Ingredients</div>
  </div>

  <div id="overview" class="card"></div>
  <div id="nutrition" class="card hidden"></div>
  <div id="ingredients" class="card hidden"></div>

  <div class="card">
    <details>
      <summary>ðŸ”® Future Enhancements</summary>
      <ul>
        <li>Detection of more additives and E-numbers</li>
        <li>Automatic ingredient translation</li>
        <li>Advanced ingredient analysis</li>
        <li>Category-based scoring</li>
      </ul>
    </details>
  </div>

  <footer>
    Data source: Open Food Facts<br>
    Results are indicative, not medical advice
  </footer>
</div>

<script>
function showTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('#overview,#nutrition,#ingredients').forEach(d=>d.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
  [...document.querySelectorAll('.tab')].find(t=>t.textContent.toLowerCase().includes(id)).classList.add('active');
}

let stream=null;
async function startScan(){
  if(!('BarcodeDetector'in window)){alert("Camera scan not supported");return;}
  const v=document.getElementById("video");v.style.display="block";
  stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
  v.srcObject=stream;await v.play();
  const d=new BarcodeDetector({formats:["ean_13","ean_8","upc_a","upc_e"]});
  (async function scan(){
    const c=await d.detect(v);
    if(c.length){document.getElementById("barcode").value=c[0].rawValue;stopScan();}
    else requestAnimationFrame(scan);
  })();
}
function stopScan(){const v=document.getElementById("video");v.style.display="none";if(stream){stream.getTracks().forEach(t=>t.stop());stream=null;}}

async function checkFood(){
  stopScan();
  const code=barcode.value.trim();
  if(!code){alert("Enter barcode");return;}

  const r=await fetch(`https://world.openfoodfacts.org/api/v0/product/${code}.json`);
  const d=await r.json();
  if(!d.product){overview.innerHTML="âŒ Product not found";return;}

  const p=d.product,n=p.nutriments||{},ing=p.ingredients_text||"Not available";
  const sugar=n.sugars_100g??null,fat=n.saturated_fat_100g??null,fiber=n.fiber_100g??null,energy=n.energy_kcal_100g??null;

  let score=100,reasons=[],good=[],warn="";
  if(sugar!==null&&sugar>10){score-=40;reasons.push("High sugar")}
  if(fat!==null&&fat>5){score-=25;reasons.push("High saturated fat")}
  if(fiber!==null&&fiber<2){score-=15;reasons.push("Low fiber")}
  if(fiber!==null&&fiber>=3)good.push("Good fiber content");
  if(sugar!==null&&sugar<=5)good.push("Low sugar");

  const soft=ing.toLowerCase().includes("carbonated")&&ing.toLowerCase().includes("sugar");
  if(soft){score=Math.min(score,30);reasons.push("Sugary beverage")}

  if(sugar===null||fat===null)warn="âš ï¸ Result based on limited nutrition data";

  let cls="healthy",label="Healthy";
  if(score<40){cls="unhealthy";label="Unhealthy"}
  else if(score<70){cls="moderate";label="Moderate"}

  overview.innerHTML=`
    <div class="score ${cls}">${score}</div>
    <div style="text-align:center"><b>${p.product_name||"Food Item"}</b><br>${label}</div>
    <div class="legend">
      <span>ðŸŸ¢ 70â€“100 Healthy</span><span>ðŸŸ¡ 40â€“69 Moderate</span><span>ðŸ”´ 0â€“39 Unhealthy</span>
    </div>
    <div class="sectionTitle good">ðŸ™‚ What We Like</div>
    <ul>${good.length?good.map(x=>`<li>${x}</li>`).join(""):"<li>â€”</li>"}</ul>
    <div class="sectionTitle bad">ðŸ˜Ÿ What Concerns Us</div>
    <ul>${reasons.length?reasons.map(x=>`<li>${x}</li>`).join(""):"<li>â€”</li>"}</ul>
    ${warn?`<div class="warning">${warn}</div>`:""}
  `;

  nutrition.innerHTML=`
    <details open><summary>Energy</summary><div class="row"><span>Energy</span><span class="value mid">${energy??"N/A"} kcal</span></div></details>
    <details><summary>Total Sugars</summary><div class="row"><span>Sugars</span><span class="value bad">${sugar??"N/A"} g</span></div></details>
    <details><summary>Total Fat</summary><div class="row"><span>Saturated Fat</span><span class="value bad">${fat??"N/A"} g</span></div></details>
    <details><summary>Dietary Fiber</summary><div class="row"><span>Fiber</span><span class="value good">${fiber??"N/A"} g</span></div></details>
  `;

  ingredients.innerHTML=`<div class="ingredients">${ing}</div>`;
}
</script>
</body>
</html>