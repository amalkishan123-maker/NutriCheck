<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nutri</title>

<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:#0b0b0b;
  color:#fff;
}
.container{
  max-width:440px;
  margin:auto;
  padding:20px;
}
h1{color:#4caf50;margin-bottom:4px}
.tagline{color:#aaa;font-size:14px;margin-bottom:20px}

.card{
  background:#141414;
  border-radius:12px;
  padding:16px;
  margin-bottom:16px;
  border:1px solid #1f1f1f;
}

input{
  width:100%;
  padding:14px;
  border-radius:8px;
  border:none;
  background:#1f1f1f;
  color:#fff;
  margin-bottom:10px;
}
button{
  width:100%;
  padding:14px;
  border-radius:8px;
  border:none;
  font-weight:bold;
  margin-bottom:10px;
  cursor:pointer;
}
.scanBtn{background:#222;color:#fff}
.checkBtn{background:#4caf50;color:#000}

.score{
  width:120px;height:120px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:34px;
  margin:10px auto;
}
.healthy{background:#1b5e20}
.moderate{background:#f9a825;color:#000}
.unhealthy{background:#8e0000}

.legend{font-size:13px;color:#bbb;text-align:center;margin-top:6px}
.legend span{margin-right:10px}

.warning{color:#ffcc80;font-size:13px;margin-top:10px}
.ingredients{font-size:13px;color:#bbb;line-height:1.5}

video{
  width:100%;
  border-radius:10px;
  margin-bottom:10px;
  display:none;
}

details{
  margin-top:10px;
}
details summary{
  cursor:pointer;
  color:#4caf50;
  font-weight:bold;
}
footer{
  margin-top:20px;
  font-size:12px;
  color:#888;
  text-align:center;
}
</style>
</head>

<body>
<div class="container">
  <h1>Nutri</h1>
  <div class="tagline">Scan ¬∑ Understand ¬∑ Decide</div>

  <div class="card">
    <input id="barcode" placeholder="Enter barcode number">
    <button class="scanBtn" onclick="startScan()">üì∑ Scan Barcode</button>
    <button class="checkBtn" onclick="checkFood()">Check Food</button>
    <video id="video"></video>
  </div>

  <div id="output"></div>

  <div class="card">
    <b>üìä What is Nutri Score?</b>
    <p style="font-size:13px;color:#bbb">
      Nutri Score represents the overall nutritional quality of a food item on a scale of 0‚Äì100.
      It is calculated using sugar, saturated fat, fiber, and ingredient analysis.
    </p>
    <div class="legend">
      <span>üü¢ 70‚Äì100 Healthy</span>
      <span>üü° 40‚Äì69 Moderate</span>
      <span>üî¥ 0‚Äì39 Unhealthy</span>
    </div>
  </div>

  <div class="card">
    <details>
      <summary>üîÆ Future Enhancements</summary>
      <ul>
        <li>Detection of more food additives and color codes (E-numbers)</li>
        <li>Automatic translation of ingredients into English</li>
        <li>Advanced ingredient and chemical analysis</li>
        <li>Category-based scoring (drinks, snacks, etc.)</li>
        <li>Personalized nutrition recommendations</li>
      </ul>
    </details>
  </div>

  <footer>
    Data source: Open Food Facts<br>
    Results are indicative and not medical advice
  </footer>
</div>

<script>
let stream=null;

async function startScan(){
  if(!('BarcodeDetector' in window)){
    alert("Camera scanning not supported on this browser");
    return;
  }
  const video=document.getElementById("video");
  video.style.display="block";
  stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
  video.srcObject=stream;
  await video.play();
  const detector=new BarcodeDetector({formats:["ean_13","ean_8","upc_a","upc_e"]});
  const scan=async()=>{
    const codes=await detector.detect(video);
    if(codes.length){
      document.getElementById("barcode").value=codes[0].rawValue;
      stopScan();
    }else requestAnimationFrame(scan);
  };
  scan();
}
function stopScan(){
  const video=document.getElementById("video");
  video.style.display="none";
  if(stream){stream.getTracks().forEach(t=>t.stop());stream=null;}
}

async function checkFood(){
  stopScan();
  const code=document.getElementById("barcode").value.trim();
  const out=document.getElementById("output");
  out.innerHTML="";
  if(!code){alert("Enter barcode");return;}

  const res=await fetch(`https://world.openfoodfacts.org/api/v0/product/${code}.json`);
  const data=await res.json();
  if(!data.product){
    out.innerHTML="<div class='card'>‚ùå Product not found in database.</div>";
    return;
  }

  const p=data.product;
  const ing=p.ingredients_text||"Not available";
  const n=p.nutriments||{};
  const sugar=n.sugars_100g ?? null;
  const fat=n.saturated_fat_100g ?? null;
  const fiber=n.fiber_100g ?? null;

  let score=100,reasons=[],suggestions=[],warning="";

  if(sugar!==null && sugar>10){score-=40;reasons.push("High sugar")}
  if(fat!==null && fat>5){score-=25;reasons.push("High saturated fat")}
  if(fiber!==null && fiber<2){score-=15;reasons.push("Low fiber")}

  const softDrink=ing.toLowerCase().includes("carbonated") && ing.toLowerCase().includes("sugar");
  if(softDrink){
    score=Math.min(score,30);
    reasons.push("Sugary beverage");
    suggestions.push("Avoid sugary drinks");
  }

  if(sugar===null || fat===null){
    warning="‚ö†Ô∏è Result based on limited nutrition data";
  }

  let cls="healthy",label="Healthy";
  if(score<40){cls="unhealthy";label="Unhealthy"}
  else if(score<70){cls="moderate";label="Moderate"}

  if(!suggestions.length)suggestions.push("Consume in moderation");

  out.innerHTML=`
    <div class="card">
      <div class="score ${cls}">${score}</div>
      <h3 style="text-align:center">${p.product_name||"Food Item"}</h3>
      <p style="text-align:center">${label}</p>

      <b>Why?</b>
      <ul>${reasons.map(r=>`<li>${r}</li>`).join("")}</ul>

      <b>Suggestions</b>
      <ul>${suggestions.map(s=>`<li>${s}</li>`).join("")}</ul>

      <b>Ingredients</b>
      <div class="ingredients">${ing}</div>

      ${warning?`<div class="warning">${warning}</div>`:""}
    </div>
  `;
}
</script>
</body>
</html>