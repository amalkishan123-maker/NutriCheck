<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Nutri - Smart Food Scanner</title>
<style>
:root{
  --bg:#0b0b0b;
  --card:#141414;
  --green:#4caf50;
  --text:#ffffff;
  --muted:#9e9e9e;
  --red:#ef5350;
  --yellow:#ffb74d;
}

*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
  line-height: 1.5;
}

.container{ max-width:460px; margin:auto; padding:16px; }
h1{color:var(--green);margin:4px 0; font-size: 28px;}
.tagline{color:var(--muted);font-size:14px;margin-bottom:12px}

/* Custom Notification Toast */
#toast {
    position: fixed;
    top: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(-100px);
    background: #222;
    color: #fff;
    padding: 12px 24px;
    border-radius: 12px;
    border: 1px solid var(--red);
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    z-index: 10000;
    transition: 0.4s ease;
    font-size: 14px;
}
#toast.show { transform: translateX(-50%) translateY(0); }

.card{
  background:var(--card);
  border-radius:18px;
  padding:18px;
  margin-bottom:14px;
}

/* Original Video Scanner UI */
#videoContainer {
  position: relative; width: 100%; border-radius: 14px; overflow: hidden; display: none; margin-bottom: 12px;
}
.scan-region {
  position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
  width: 70%; height: 50%; border: 2px solid var(--green); border-radius: 12px;
  box-shadow: 0 0 0 9999px rgba(0,0,0,0.6); pointer-events: none;
}
.scan-line {
  position: absolute; width: 100%; height: 2px; background: var(--green); top: 0;
  animation: moveLine 2s infinite linear;
}
@keyframes moveLine { 0% { top: 0; } 50% { top: 100%; } 100% { top: 0; } }

input{
  width:100%; padding:14px; font-size:16px; border-radius:12px;
  border:2px solid #222; background:#1f1f1f; color:#fff; margin-bottom:12px;
}

button{ width:100%; padding:14px; border:none; border-radius:12px; font-weight:bold; cursor:pointer; }
.scanBtn{background:#2a2a2a; color:#fff; margin-bottom:8px}
.checkBtn{background:var(--green); color:#000}

.tabs{ display:flex; gap:6px; margin-bottom:16px; }
.tab{
  flex:1; text-align:center; padding:10px 4px; border-radius:10px;
  background:#1f1f1f; color:#888; cursor:pointer; font-size: 13px;
}
.tab.active{ background:var(--green); color:#000; font-weight:bold; }

/* Score UI */
.score-circle {
  width: 100px; height: 100px; border-radius: 50%;
  display: flex; flex-direction: column; align-items: center; justify-content: center;
  font-size: 32px; font-weight: 800; margin: 20px auto;
  background: radial-gradient(circle at center, #1a1a1a, #0b0b0b);
  border: 4px solid #333;
}
.score-circle span { font-size: 10px; color: var(--muted); text-transform: uppercase; margin-top: -5px; }

/* Bio-Data Progress Bars */
.bio-row { margin-bottom: 18px; }
.bio-label { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 6px; }
.bio-bar-bg { background: #222; height: 8px; border-radius: 4px; width: 100%; overflow: hidden; }
.bio-bar-fill { height: 100%; border-radius: 4px; transition: 0.5s ease; }

.analysis-card { background:#000; padding:15px; border-radius:12px; margin-top: 15px; }
.alert-item { border-left: 3px solid var(--red); padding-left: 10px; margin-bottom: 10px; }
.alert-item b { font-size: 12px; text-transform: uppercase; color: var(--red); }
.alert-item p { margin: 2px 0; font-size: 13px; }

.hidden{display:none}
</style>
</head>

<body>
<div id="toast">Barcode unknown</div>

<div class="container">
  <h1>Nutri</h1>
  <div class="tagline">Scan ¬∑ Understand ¬∑ Decide</div>

  <div class="card">
    <div id="videoContainer">
      <video id="video" style="width:100%"></video>
      <div class="scan-region"><div class="scan-line"></div></div>
    </div>
    <input id="barcode" type="number" placeholder="Enter barcode number">
    <button class="scanBtn" onclick="toggleScan()">üì∑ Scan Barcode</button>
    <button id="checkBtn" class="checkBtn" onclick="checkFood()">Check Food</button>
  </div>

  <div class="tabs">
    <div class="tab active" onclick="openTab('overview', this)">Overview</div>
    <div class="tab" onclick="openTab('nutrition', this)">Bio-Data</div>
    <div class="tab" onclick="openTab('ingredients', this)">Ingredients</div>
  </div>

  <div id="overview" class="card screen">
    <p style="text-align:center; color:var(--muted)">Ready for analysis.</p>
  </div>
  <div id="nutrition" class="card hidden screen"></div>
  <div id="ingredients" class="card hidden screen"></div>
</div>

<script>
let stream = null;
const BAN_DATA = {
  "titanium dioxide": "Banned in EU.",
  "aspartame": "Restricted sweetener.",
  "potassium bromate": "Banned in UK/Canada.",
  "sodium nitrite": "Preservative risk.",
  "red 40": "EU warning required."
};

function showToast(msg) {
    const t = document.getElementById("toast");
    t.innerText = msg;
    t.classList.add("show");
    setTimeout(() => t.classList.remove("show"), 3000);
}

function openTab(id, el){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.screen').forEach(d=>d.classList.add('hidden'));
  if(el) el.classList.add('active');
  document.getElementById(id).classList.remove('hidden');
}

async function toggleScan() {
  const container = document.getElementById("videoContainer");
  if (stream) {
    container.style.display = "none";
    stream.getTracks().forEach(t=>t.stop());
    stream = null;
  } else {
    container.style.display = "block";
    stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});
    video.srcObject = stream;
    video.play();
  }
}

async function checkFood() {
  const code = document.getElementById("barcode").value.trim();
  if(!code) return;
  const btn = document.getElementById("checkBtn");
  btn.innerText = "Analyzing...";

  try {
    const res = await fetch(`https://world.openfoodfacts.org/api/v2/product/${code}.json`);
    const data = await res.json();
    if(!data.product) { showToast("‚ùå Code unknown"); return; }
    renderProduct(data.product);
  } catch (e) { showToast("‚ö†Ô∏è Error"); }
  finally { btn.innerText = "Check Food"; }
}

function renderProduct(p) {
  const n = p.nutriments || {};
  const sugar = n.sugars_100g || 0;
  const fat = n.fat_100g || 0;
  const salt = n.salt_100g || 0;
  const energy = n.energy_kcal_100g || 0;
  const ingredients = (p.ingredients_text || "").toLowerCase();
  
  // --- STRICT SCORING ---
  let score = 100;
  if(sugar > 50) score -= 50; 
  else if(sugar > 20) score -= 30;
  if (p.nova_group === 4) score -= 30;
  score = Math.max(0, score);
  const statusColor = score > 70 ? 'var(--green)' : (score > 40 ? 'var(--yellow)' : 'var(--red)');

  // Overview
  const alerts = [];
  if (p.nova_group === 4) alerts.push({ label: "Ultra-Processed", msg: "Industrial formulation.", color: "var(--red)" });
  for (const [chem, ban] of Object.entries(BAN_DATA)) {
    if (ingredients.includes(chem)) alerts.push({ label: "Restricted", msg: `Contains ${chem}.`, ban: `‚ö†Ô∏è ${ban}`, color: "var(--red)" });
  }

  document.getElementById('overview').innerHTML = `
    <div class="score-circle" style="border-color:${statusColor}">
      <span style="color:${statusColor}">${score}</span>
      <span>Score</span>
    </div>
    <div style="text-align:center; margin-bottom:20px">
      <h2 style="margin:0">${p.product_name || 'Item'}</h2>
      <div style="color:var(--muted); font-size:12px">${p.brands || ''}</div>
    </div>
    <div class="analysis-card">
      ${alerts.map(a => `
        <div class="alert-item"><b>${a.label}</b><p>${a.msg}</p></div>
      `).join('') || '<p style="color:var(--green); font-size:12px">‚úì No high-risk chemicals detected.</p>'}
    </div>
  `;

  // Bio-Data (Nutrition Redesign)
  const getBarColor = (val, high) => val > high ? 'var(--red)' : 'var(--green)';
  
  document.getElementById('nutrition').innerHTML = `
    <h3 style="margin-top:0">Nutritional Profile (100g)</h3>
    <div class="bio-row">
        <div class="bio-label"><span>Sugar Content</span><span>${sugar}g</span></div>
        <div class="bio-bar-bg"><div class="bio-bar-fill" style="width:${Math.min(sugar, 100)}%; background:${getBarColor(sugar, 15)}"></div></div>
    </div>
    <div class="bio-row">
        <div class="bio-label"><span>Total Fat</span><span>${fat}g</span></div>
        <div class="bio-bar-bg"><div class="bio-bar-fill" style="width:${Math.min(fat, 100)}%; background:${getBarColor(fat, 20)}"></div></div>
    </div>
    <div class="bio-row">
        <div class="bio-label"><span>Energy (Calories)</span><span>${energy} kcal</span></div>
        <div class="bio-bar-bg"><div class="bio-bar-fill" style="width:${Math.min((energy/800)*100, 100)}%; background:var(--yellow)"></div></div>
    </div>
    <div style="background:#000; padding:12px; border-radius:12px; margin-top:20px; text-align:center;">
        <div style="font-size:10px; color:var(--muted);">PROCESSING LEVEL</div>
        <div style="font-size:18px; font-weight:bold; color:var(--yellow)">NOVA Group ${p.nova_group || 'N/A'}</div>
    </div>
  `;

  // Ingredients
  document.getElementById('ingredients').innerHTML = `
    <h3 style="margin-top:0">Full Ingredient List</h3>
    <div style="font-size:14px; color:#ccc; line-height:1.7; background:#000; padding:15px; border-radius:12px;">
        ${p.ingredients_text || "No data provided by manufacturer."}
    </div>
  `;

  openTab('overview');
}
</script>
</body>
</html>

