<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Nutri</title>

<link rel="manifest" href="manifest.json">

<style>
:root{
  --bg:#0b0b0b;
  --card:#151515;
  --green:#4CAF50;
  --yellow:#FFB020;
  --red:#E53935;
  --text:#ffffff;
  --muted:#9a9a9a;
}

*{box-sizing:border-box;font-family:system-ui,-apple-system,sans-serif}

body{
  margin:0;
  background:radial-gradient(circle at top,#111,#000);
  color:var(--text);
  min-height:100vh;
}

/* Header */
header{
  padding:24px;
}
header h1{
  margin:0;
  font-size:32px;
  color:var(--green);
}
header p{
  margin:6px 0 0;
  color:var(--muted);
}

/* Card */
.card{
  background:var(--card);
  margin:16px;
  padding:20px;
  border-radius:20px;
  box-shadow:0 20px 40px rgba(0,0,0,.5);
  animation:fadeUp .6s ease;
}

/* Inputs */
input{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  outline:none;
  background:#222;
  color:#fff;
  font-size:16px;
  margin-bottom:12px;
}

/* Buttons */
button{
  width:100%;
  padding:16px;
  border-radius:14px;
  border:none;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  margin-bottom:10px;
}
.btn-green{background:var(--green);color:#000}
.btn-dark{background:#1f1f1f;color:#fff}

/* Tabs */
.tabs{
  display:flex;
  gap:10px;
  margin:10px 16px;
}
.tab{
  flex:1;
  text-align:center;
  padding:12px;
  border-radius:14px;
  background:#1f1f1f;
  color:#aaa;
  cursor:pointer;
}
.tab.active{
  background:var(--green);
  color:#000;
  font-weight:600;
}

/* Sections */
.section{
  display:none;
  animation:fadeSlide .5s ease;
}
.section.active{display:block}

/* Score */
.score-wrap{
  display:flex;
  flex-direction:column;
  align-items:center;
  gap:10px;
}
.score{
  width:160px;
  height:160px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:42px;
  font-weight:700;
  animation:pop .6s ease;
}
.score.green{background:rgba(76,175,80,.2);color:var(--green)}
.score.yellow{background:rgba(255,176,32,.2);color:var(--yellow)}
.score.red{background:rgba(229,57,53,.2);color:var(--red)}

h2{margin:6px 0 0}
small{color:var(--muted)}

/* Lists */
.list{
  margin-top:20px;
}
.list h3{
  margin-bottom:8px;
}
.list ul{
  padding-left:18px;
}
.list li{
  margin-bottom:6px;
}

/* Animations */
@keyframes fadeUp{
  from{opacity:0;transform:translateY(20px)}
  to{opacity:1;transform:none}
}
@keyframes fadeSlide{
  from{opacity:0;transform:translateX(20px)}
  to{opacity:1;transform:none}
}
@keyframes pop{
  0%{transform:scale(.6)}
  100%{transform:scale(1)}
}
</style>
</head>

<body>

<header>
  <h1>Nutri</h1>
  <p>Scan â€¢ Understand â€¢ Decide</p>
</header>

<div class="card">
  <input id="barcode" placeholder="Enter barcode number"/>
  <button class="btn-dark" onclick="scan()">ðŸ“· Scan Barcode</button>
  <button class="btn-green" onclick="checkFood()">Check Food</button>
</div>

<div class="tabs">
  <div class="tab active" onclick="openTab('overview')">Overview</div>
  <div class="tab" onclick="openTab('nutrition')">Nutrition</div>
  <div class="tab" onclick="openTab('ingredients')">Ingredients</div>
</div>

<div id="overview" class="section active card">
  <div class="score-wrap">
    <div id="scoreCircle" class="score yellow">--</div>
    <h2 id="product">Product</h2>
    <small id="verdict">Nutri Score (0â€“100)</small>
  </div>

  <div class="list">
    <h3>ðŸ˜Š What We Like</h3>
    <ul id="likes"></ul>
  </div>

  <div class="list">
    <h3>ðŸ˜Ÿ What Concerns Us</h3>
    <ul id="concerns"></ul>
  </div>
</div>

<div id="nutrition" class="section card">
  <div id="nutritionData">No data</div>
</div>

<div id="ingredients" class="section card">
  <div id="ingredientData">No data</div>
</div>

<script>
function openTab(id){
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  event.target.classList.add('active');
  document.getElementById(id).classList.add('active');
}

async function checkFood(){
  const code=document.getElementById('barcode').value.trim();
  if(!code) return alert("Enter barcode");

  const res=await fetch(`https://world.openfoodfacts.org/api/v0/product/${code}.json`);
  const data=await res.json();
  if(!data.product){alert("Product not found");return}

  const p=data.product;
  document.getElementById('product').innerText=p.product_name||"Unknown product";

  const sugar=p.nutriments?.sugars_100g||0;
  const fat=p.nutriments?.fat_100g||0;
  const fiber=p.nutriments?.fiber_100g||0;

  let score=100 - (sugar*2 + fat*1.5 - fiber*2);
  score=Math.max(0,Math.min(100,Math.round(score)));

  const circle=document.getElementById('scoreCircle');
  circle.innerText=score;
  circle.className="score "+(score>70?"green":score>40?"yellow":"red");
  document.getElementById('verdict').innerText=score>70?"Healthy choice":score>40?"Moderate":"Unhealthy";

  const likes=[],concerns=[];
  if(fiber>3) likes.push("Good fiber content");
  if(sugar<5) likes.push("Low sugar");
  if(fat<10) likes.push("Low fat");
  if(!likes.length) likes.push("No major positive nutritional factors");

  if(sugar>10) concerns.push("High sugar");
  if(fat>15) concerns.push("High fat");
  if(fiber<2) concerns.push("Low fiber");

  document.getElementById('likes').innerHTML=likes.map(i=>`<li>${i}</li>`).join('');
  document.getElementById('concerns').innerHTML=concerns.map(i=>`<li>${i}</li>`).join('');

  document.getElementById('nutritionData').innerHTML=`
    Energy: ${p.nutriments?.energy_kcal_100g||"N/A"} kcal<br>
    Sugars: ${sugar} g<br>
    Fat: ${fat} g<br>
    Fiber: ${fiber} g
  `;

  document.getElementById('ingredientData').innerText=
    p.ingredients_text || "Ingredients not available (may be country-specific)";
}

function scan(){
  alert("Camera scanning works only when installed as app (PWA/APK)");
}

if('serviceWorker' in navigator){
  navigator.serviceWorker.register('service-worker.js');
}
</script>

</body>
</html>
